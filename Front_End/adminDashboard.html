<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Easy Car Rental</title>
    <meta content="width=device-width initial-scale=1" name="viewport">
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@1,700&display=swap" rel="stylesheet">

    <style>
        * {
            scroll-behavior: smooth;
            transition: all 1s;
        }

        #dashboardPage {
            display: block;
        }

        #carPage {
            display: none;
        }

        #driverPage {
            display: none;
        }

        #customerPage {
            display: none;
        }
    </style>


</head>
<body>
<!--Navbar-->
<nav class="navbar navbar-expand-lg bg-body-tertiary shadow-lg bg-white col-12">
    <div class="container-fluid row">
        <a class="navbar-brand col-5 ml-5" href="index.html">
            <img alt="Logo" class="d-inline-block align-text-top" height="50" src="assets/img/Easy Car Rental Logo.jpg"
                 width="100">
        </a>
        <button aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler"
                data-bs-target="#navbarNav" data-bs-toggle="collapse" type="button">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse ml-5 mr-0 pr-0 flex-grow-0" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item ml-3 mr-3">
                    <button class="btn btn-primary" id="pendingReqBtn"
                            style="background: #FB6011; border-color: #FB6011"
                            type="button">Pending Request
                    </button>
                </li>
                <li class="nav-item ml-3 mr-3">
                    <a class="nav-link" href="#" id="dashboardNav">DASHBOARD</a>
                </li>
                <li class="nav-item ml-3 mr-3">
                    <a class="nav-link" href="#" id="carsNav">CAR</a>
                </li>
                <li class="nav-item ml-3 mr-3">
                    <a class="nav-link" href="#" id="customersNav">USER</a>
                </li>
                <li class="nav-item ml-3 mr-3">
                    <a class="nav-link" href="#" id="driversNav">DRIVER</a>
                </li>
                <li class="nav-item ml-3 mr-3">
                    <a class="nav-link" href="#" id="bookingNav">BOOKINGS</a>
                </li>
                <li class="nav-item ml-3 mr-3">
                    <a class="nav-link" href="#" id="signOutNav">SIGN OUT</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!--Dashboard-->
<div class="container-fluid bg-white row" id="dashboardPage">

    <div class="jumbotron pt-md-5 mt-2 col-12 ml-3">
        <div id="home-tiles">
            <div class="row ">
                <div class="col-lg-6 col-xl-4 mb-2">
                    <div class="card">
                        <div class="card-header" style="background: #FB6011">REGISTERED USERS</div>
                        <div class="card-body">
                            <div class="dash-tile-icon"><i class="fas fa-users"></i></div>
                            <div class="dash-tile-text text-right text-black-50"><h2 id="registeredUserCount">00</h2>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-xl-4 mb-2">
                    <div class="card">
                        <div class="card-header" style="background: #FB6011">REGISTERED DRIVERS</div>
                        <div class="card-body">
                            <div class="dash-tile-icon"><i class="fas fa-cubes"></i></div>
                            <div class="dash-tile-text text-right text-black-50"><h2 id="registeredDriversCount">00</h2>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-xl-4 mb-2">
                    <div class="card">
                        <div class="card-header" style="background: #FB6011">BOOKING FOR THE DAY</div>
                        <div class="card-body">
                            <div class="dash-tile-icon"><i class="fas fa-shopping-cart"></i></div>
                            <div class="dash-tile-text text-right text-black-50"><h2 id="bookingForDayCount">00</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="jumbotron pt-5 mb-4 col-12 ml-3">
        <div class="row justify-content-center">
            <div class="col-12 bg-white row rounded-sm mb-3">
                <h2 class="h2 col-3 mb-4 mt-4" style="font-family: 'Josefin Sans', sans-serif; font-style: italic">
                    AVAILABLE CARS :</h2>
                <h2 class="h2 col-2 mb-4 mt-4" id="availableCarCount"
                    style="font-family: 'Josefin Sans', sans-serif; font-style: italic">
                    00</h2>
                <h2 class="h2 col-3 mb-4 mt-4" style="font-family: 'Josefin Sans', sans-serif; font-style: italic">
                    RESERVED CARS :</h2>
                <h2 class="h2 col-2 mb-4 mt-4" id="reservedCarCount"
                    style="font-family: 'Josefin Sans', sans-serif;font-style: italic">
                    00</h2>
            </div>
            <div class="col-12 bg-white row rounded-sm mb-3">
                <h2 class="h2 col-3 mb-4 mt-4" style="font-family: 'Josefin Sans', sans-serif; font-style: italic">
                    AVAILABLE DRIVERS :</h2>
                <h2 class="h2 col-2 mb-4 mt-4" id="availableDriverCount" style="font-family: 'Josefin Sans', sans-serif; font-style: italic">
                    00</h2>
                <h2 class="h2 col-3 mb-4 mt-4" style="font-family: 'Josefin Sans', sans-serif; font-style: italic">
                    OCCUPIED DRIVERS :</h2>
                <h2 class="h2 col-2 mb-4 mt-4" id="unAvailableDriverCount" style="font-family: 'Josefin Sans', sans-serif;font-style: italic">
                    00</h2>
            </div>
            <div class="col-12 bg-white row rounded-sm mb-3">
                <h2 class="h2 col-3 mb-4 mt-4" style="font-family: 'Josefin Sans', sans-serif; font-style: italic">NEED
                    MAINTENANCE :</h2>
                <h2 class="h2 col-2 mb-4 mt-4" style="font-family: 'Josefin Sans', sans-serif; font-style: italic">
                    00</h2>
                <h2 class="h2 col-3 mb-4 mt-4" style="font-family: 'Josefin Sans', sans-serif; font-style: italic">UNDER
                    MAINTENANCE :</h2>
                <h2 class="h2 col-2 mb-4 mt-4" style="font-family: 'Josefin Sans', sans-serif;font-style: italic">
                    00</h2>
            </div>
        </div>
    </div>


</div>

<!--Car Management-->
<div class="mt-5 mb-5" id="carPage">
    <div class="container-fluid">
        <div class="mt-md-4 mb-md-4">
            <h1>Cars</h1>
            <div class="row ">
                <div class="col-4">
                    <form id="carForm">
                        <div class="row mt-4 form-group">
                            <div class="col">
                                <label for="registrationNo">Reg Number</label>
                                <input class="form-control" id="registrationNo" name="registrationNo"
                                       placeholder="ABC-1234"
                                       type="text">
                            </div>
                            <div class="col">
                                <label for="make">Brand</label>
                                <input class="form-control" id="make" name="carBrand"
                                       placeholder="Toyota, Suzuki, Honda"
                                       type="text">
                            </div>
                        </div>
                        <div class="row mt-4 form-group">
                            <div class="col">
                                <label for="category">Category</label>
                                <select class="form-control" id="category" name="carType">
                                    <option>Genaral</option>
                                    <option>Premium</option>
                                    <option>Luxury</option>
                                </select>
                            </div>
                            <div class="col">
                                <label for="fuel">Fuel Type</label>
                                <select class="form-control" id="fuel" name="fuelType">
                                    <option>Petrol</option>
                                    <option>Diesel</option>
                                    <option>Hybrid</option>
                                    <option>Electric</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row mt-4">
                            <div class="col">
                                <label for="transmission">Transmission Type</label>
                                <select class="form-control" id="transmission" name="transmissionType">
                                    <option>Auto</option>
                                    <option>Manual</option>
                                </select>
                            </div>
                            <div class="col">
                                <label for="color">Color</label>
                                <input class="form-control" id="color" name="color" placeholder="White, Wine Red"
                                       type="text">
                            </div>
                            <div class="col">
                                <label for="noOfPassengers">No Of Passengers</label>
                                <input class="form-control" id="noOfPassengers" name="numberOfPassengers"
                                       placeholder="4"
                                       type="text">
                            </div>
                        </div>
                        <div class="form-group row mt-4">
                            <div class="col">
                                <label for="priceDay">Price per Day</label>
                                <input class="form-control" id="priceDay" name="dailyPrice" placeholder="Rs:"
                                       type="text">
                            </div>
                            <div class="col">
                                <label for="priceMonth">Price per Month</label>
                                <input class="form-control" id="priceMonth" name="monthlyPrice" placeholder="Rs:"
                                       type="text">
                            </div>
                            <div class="col">
                                <label for="priceKm">Price per Extra Km</label>
                                <input class="form-control" id="priceKm" name="priceForExtraKM" placeholder="Rs:"
                                       type="text">
                            </div>
                        </div>
                        <div class="form-group row mt-4 mb-0">
                            <label class="col-12">Upload Car Images</label>
                            <div class="col">
                                <label for="imgFront">Front</label>
                                <input class="form-control-file" id="imgFront" name="img" type="file">
                            </div>
                            <div class="col">
                                <label for="imgBack">Back</label>
                                <input class="form-control-file" id="imgBack" name="img" type="file">
                            </div>
                            <div class="col">
                                <label for="imgSide">Side</label>
                                <input class="form-control-file" id="imgSide" name="img" type="file">
                            </div>
                            <div class="col">
                                <label for="imgInside">Inside</label>
                                <input class="form-control-file" id="imgInside" name="img" type="file">
                            </div>
                        </div>
                        <div class="form-group row mt-4 mb-5">
                            <div class="col-9 btn-group">
                                <button class="btn btn-success" id="btnSaveCar" type="button">Save</button>
                                <button class="btn btn-warning" id="btnUpdateCar" type="button">Update</button>
                                <button class="btn btn-danger" id="btnDeleteCar" type="button">Delete</button>
                            </div>
                        </div>
                    </form>
                </div>


                <!--  car table-->
                <div class="col-8 table-responsive" style="height: 60vh; overflow-y: scroll;">
                    <table class="table shadow table-hover">
                        <thead class="thead-dark">
                        <tr class="table-primary">
                            <th scope="col">RegNo</th>
                            <th scope="col">Brand</th>
                            <th scope="col">Type</th>
                            <th scope="col">NoPas</th>
                            <th scope="col">Fuel</th>
                            <th scope="col">Transmission</th>
                            <th scope="col">Color</th>
                            <th scope="col">Daily Price</th>
                            <th scope="col">Monthly Price</th>
                            <th scope="col">Extra KM</th>
                            <th scope="col">Status</th>
                            <th scope="col">Available</th>
                        </tr>
                        </thead>
                        <tbody id="tblCar">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!--Customer ManagementDriver-->
<div class="mb-3 mt-5" id="customerPage">
    <div class="container-fluid">
        <div class="mt-md-4 mb-md-4">
            <h1>Users</h1>
            <div class="row ">
                <div class="col-4">
                    <form>
                        <div class="row mt-4">
                            <div class="col">
                                <label for="user_name">Name</label>
                                <input class="form-control" disabled id="user_name" placeholder="Pasan Kumara"
                                       type="text">
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col">
                                <label for="user_nic">NIC Number</label>
                                <input class="form-control" disabled id="user_nic" placeholder="200236287348"
                                       type="text">
                            </div>
                            <div class="col">
                                <label for="user_address">Address</label>
                                <input class="form-control" disabled id="user_address" placeholder="721/C, Galle."
                                       type="text">
                            </div>
                        </div>
                        <div class="row mt-4 mb-5">
                            <div class="col">
                                <label for="user_contact">Contact Number</label>
                                <input class="form-control" disabled id="user_contact" placeholder="0712345678"
                                       type="text">
                            </div>
                            <div class="col">
                                <label for="user_email">Email</label>
                                <input class="form-control" disabled id="user_email" placeholder="example@email.com"
                                       type="text">
                            </div>
                        </div>
                        <div class="form-group row mt-4 mb-4">
                            <div class="col-6 btn-group">
                                <button class="btn btn-danger" id="btnDeleteUser" type="button">Delete</button>
                            </div>
                        </div>
                    </form>
                    <img id="userImg" style="width: 23vw; height: 23vh;">
                </div>
                <!--  Customer table-->
                <div class="col-8 table-responsive" style="height: 61vh; overflow-y: scroll;">
                    <table class="table shadow table-hover">
                        <thead class="thead-dark">
                        <tr class="table-primary">
                            <th scope="col">Name</th>
                            <th scope="col">Address</th>
                            <th scope="col">NIC</th>
                            <th scope="col">Email</th>
                            <th scope="col">Contact</th>
                        </tr>
                        </thead>
                        <tbody id="tblCustomer">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!--Driver Management-->
<div class="mb-5 mt-5" id="driverPage">
    <div class="container-fluid">
        <div class="mt-md-4 mb-md-4">
            <h1>Drivers</h1>
            <div class="row ">
                <div class="col-4">
                    <form>
                        <div class="row mt-4">
                            <div class="col">
                                <label for="dr_name">Name</label>
                                <input class="form-control" id="dr_name" placeholder="Pasan Kumara"
                                       type="text">
                            </div>
                            <div class="col">
                                <label for="dr_lic">License Number</label>
                                <input class="form-control" id="dr_lic" placeholder="B12345678" type="text">
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col">
                                <label for="dr_contact">Contact Number</label>
                                <input class="form-control" id="dr_contact" placeholder="0712345678"
                                       type="text">
                            </div>
                            <div class="col">
                                <label for="dr_contact">Address</label>
                                <input class="form-control" id="dr_address" placeholder="Colombo 07"
                                       type="text">
                            </div>
                        </div>
                        <div class="mt-4">
                            <label for="dr_email">Email</label>
                            <input class="form-control" id="dr_email" placeholder="contac@gamil.com"
                                   type="text">
                        </div>
                        <div class="form-group row mt-4 mb-5">
                            <div class="col-8 btn-group">
                                <button class="btn btn-success" id="btnAddDriver" type="button">Add</button>
                                <button class="btn btn-warning" id="btnUpdateDriver" type="button">Update</button>
                                <button class="btn btn-danger" id="btnDeleteDriver" type="button">Delete</button>
                            </div>
                        </div>
                    </form>

                </div>


                <!--  Driver table-->
                <div class="col-8 table-responsive" style="height: 61vh; overflow-y: scroll;">
                    <table class="table shadow table-hover">
                        <thead class="thead-dark">
                        <tr class="table-primary">
                            <th scope="col">License Number</th>
                            <th scope="col">Name</th>
                            <th scope="col">Contact</th>
                            <th scope="col">Email</th>
                            <th scope="col">Address</th>
                            <th scope="col">Availability</th>
                        </tr>
                        </thead>
                        <tbody id="tblDriver">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!--Booking Management-->
<div class="mb-5 mt-5" id="bookingPage">
    <div class="container-fluid">
        <div class="mt-md-4 mb-md-4">
            <!--  Driver table-->
            <div class="table-responsive" style="height: 67vh; overflow-y: scroll;">
                <table class="table shadow table-hover">
                    <thead class="thead-dark">
                    <tr class="table-primary">
                        <th scope="col">Booking ID</th>
                        <th scope="col">Customer Email</th>
                        <th scope="col">Car</th>
                        <th scope="col">Pick Up Date</th>
                        <th scope="col">Return Date</th>
                        <th scope="col">Total</th>
                        <th scope="col">Driver</th>
                        <th scope="col">Status</th>
                    </tr>
                    </thead>
                    <tbody id="tblBooking">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!--Modal-->
<div aria-hidden="true" aria-labelledby="exampleModalToggleLabel2" class="modal fade" id="exampleModalToggle2"
     tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content" style="width: 65vw;">
            <div class="modal-header">
                <h1 class="modal-title fs-5 col-12"
                    style="font-family: 'Josefin Sans', sans-serif; font-size: 40px; font-style: italic">Pending
                    Request</h1>
            </div>
            <div class="modal-body position-relative">
                <!--  Pending Request table-->
                <div class="table-responsive" style="height: 40vh; overflow-y: scroll;">
                    <table class="table shadow table-hover">
                        <thead class="thead-dark">
                        <tr class="table-primary">
                            <th scope="col">Booking ID</th>
                            <th scope="col">Customer Email</th>
                            <th scope="col">Car</th>
                            <th scope="col">Pick Up Date</th>
                            <th scope="col">Return Date</th>
                            <th scope="col">Total</th>
                            <th scope="col">Driver</th>
                            <th scope="col">Booking Status</th>
                            <th scope="col">Options</th>
                        </tr>
                        </thead>
                        <tbody id="tblPendingReq">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" data-target="#exampleModal"
                        data-toggle="modal"
                        type="button">Go Back
                </button>
            </div>
        </div>
    </div>
</div>

<footer>
    <div class="container-fluid" style="background: #1C201F">
        <div class="row">
            <img alt="Logo" class="" src="assets/img/Easy Car Rental Logo.jpg">
        </div>
    </div>
</footer>
<script src="assets/js/jquery-3.6.1.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>

<script>

    let baseURL = "http://localhost:8080/easy/";

    loadAllCustomers();
    loadAllCar();
    loadAllDriver();
    loadAllBookings();
    loadDataOnAdminDashboard();

    $("#pendingReqBtn").click(function () {
        loadPendingData();
        $('#exampleModalToggle2').modal('show');
    });

    // Pending Request

    function loadPendingData() {
        $("#tblPendingReq").empty();
        $.ajax({
            url: baseURL + "booking",
            dataType: "json",
            success: function (resp) {
                for (let cus of resp.data) {
                    if (cus.bkAdminStatus === "Unapproved") {
                        var row = '<tr><td>' + cus.bkId + '</td><td>' + cus.bkCusEmail + '</td><td>' + cus.bkCar + '</td><td>' + cus.bkDate + '</td><td>' + cus.bkReturnDate + '</td><td>' + cus.bkTotal + '</td><td>' + cus.bkDriver + '</td><td>' + cus.bkStatus + '</td><td>' + `<button class="btn btn-success btnApprove" type="button">Approve</button><button class="btn btn-danger ml-2 btnReject" type="button">Reject</button>` + '</td></tr>';
                        $("#tblPendingReq").append(row);
                    }
                }
            },
            error: function (err) {
                console.log(err);
            }
        });
    }

    function loadDataOnAdminDashboard() {
        $.ajax({
            url: baseURL + "admin/u",
            dataType: "json",
            success: function (resp) {
                $('#registeredUserCount').text(resp.data);
            }
        });

        $.ajax({
            url: baseURL + "admin/d",
            dataType: "json",
            success: function (resp) {
                $('#registeredDriversCount').text(resp.data);
            }
        });

        $.ajax({
            url: baseURL + "admin/b",
            dataType: "json",
            success: function (resp) {
                $('#bookingForDayCount').text(resp.data);
            }
        });

        $.ajax({
            url: baseURL + "car/availableCount",
            dataType: "json",
            success: function (resp) {
                $('#availableCarCount').text(resp.data[0]);
                $('#reservedCarCount').text(resp.data[1]);
            }
        });

        $.ajax({
            url: baseURL + "driver/availableCount",
            dataType: "json",
            success: function (resp) {
                $('#availableDriverCount').text(resp.data[0]);
                $('#unAvailableDriverCount').text(resp.data[1]);
            }
        });
    }

    $(document).on('click', '.btnApprove', function () {

        let bkId = $(this).closest('tr').children(":eq(0)").text();
        let bkCusEmail = $(this).closest('tr').children(":eq(1)").text();
        let bkCar = $(this).closest('tr').children(":eq(2)").text();
        let bkDate = $(this).closest('tr').children(":eq(3)").text();
        let bkReturnDate = $(this).closest('tr').children(":eq(4)").text();
        let bkTotal = $(this).closest('tr').children(":eq(5)").text();
        let bkDriver = $(this).closest('tr').children(":eq(6)").text();

        var reserveObj = {
            bkId: bkId,
            bkCusEmail: bkCusEmail,
            bkCar: bkCar,
            bkDate: bkDate,
            bkReturnDate: bkReturnDate,
            bkTotal: bkTotal,
            bkDriver: bkDriver,
            bkStatus: "Active",
            bkAdminStatus: "Approved"
        }

        $.ajax({
            url: baseURL + 'booking',
            method: 'put',
            contentType: "application/json",
            data: JSON.stringify(reserveObj),
            dataType: "json",
            success: function (res) {
                loadPendingData();
                loadDataOnAdminDashboard();
            },
            error: function (error) {
                let cause = JSON.parse(error.responseText).message;
                alert(cause);
            }

        });
    });

    $("#bookingPage").css("display", "none");

    $("#signOutNav").click(function () {
        $.ajax({
            url: baseURL + "admin/rem",
            method: "post",
            success: function (resp) {
                window.location.href = "index.html";
            },
            error: function (err) {
                console.log(err);
            }
        });
    });

    $("#dashboardNav").click(function () {
        $("#dashboardPage").css("display", "block");
        $("#carPage").css("display", "none");
        $("#customerPage").css("display", "none");
        $("#driverPage").css("display", "none");
        $("#bookingPage").css("display", "none");
        loadDataOnAdminDashboard();

    });

    $("#carsNav").click(function () {
        $("#dashboardPage").css("display", "none");
        $("#carPage").css("display", "block");
        $("#customerPage").css("display", "none");
        $("#driverPage").css("display", "none");
        $("#bookingPage").css("display", "none");
        loadAllCar();
    });

    $("#customersNav").click(function () {
        $("#dashboardPage").css("display", "none");
        $("#carPage").css("display", "none");
        $("#customerPage").css("display", "block");
        $("#driverPage").css("display", "none");
        $("#bookingPage").css("display", "none");
        loadAllCustomers();
    });

    $("#driversNav").click(function () {
        $("#dashboardPage").css("display", "none");
        $("#carPage").css("display", "none");
        $("#customerPage").css("display", "none");
        $("#bookingPage").css("display", "none");
        $("#driverPage").css("display", "block");
        loadAllDriver();
    });

    $("#bookingNav").click(function () {
        $("#dashboardPage").css("display", "none");
        $("#carPage").css("display", "none");
        $("#customerPage").css("display", "none");
        $("#driverPage").css("display", "none");
        $("#bookingPage").css("display", "block");
        loadAllBookings();
    });

    // Booking Table Functions

    function loadAllBookings() {
        $("#tblBooking").empty();
        $.ajax({
            url: baseURL + "booking",
            dataType: "json",
            success: function (resp) {
                for (let cus of resp.data) {
                    if (cus.bkAdminStatus === "Approved") {
                        var row = '<tr><td>' + cus.bkId + '</td><td>' + cus.bkCusEmail + '</td><td>' + cus.bkCar + '</td><td>' + cus.bkDate + '</td><td>' + cus.bkReturnDate + '</td><td>' + cus.bkTotal + '</td><td>' + cus.bkDriver + '</td><td>' + cus.bkStatus + '</td></tr>';
                        $("#tblBooking").append(row);
                    }
                }
            }
        });
    }

    // Customer CRUD and Table Functions

    function loadAllCustomers() {
        $("#tblCustomer").empty();
        $.ajax({
            url: baseURL + "user",
            dataType: "json",
            success: function (resp) {
                for (let cus of resp.data) {
                    var row = '<tr><td>' + cus.userName + '</td><td>' + cus.userAddress + '</td><td>' + cus.userNICorLicenceNo + '</td><td>' + cus.userEmail + '</td><td>' + cus.userContact + '</td></tr>';
                    $("#tblCustomer").append(row);
                }
                bindRowClickEventsUser();
            }
        });
    }

    function bindRowClickEventsUser() {
        $("#tblCustomer>tr").click(function () {
            let cusName = $(this).children("td:eq(0)").text();
            let cusAddress = $(this).children("td:eq(1)").text();
            let cusNic = $(this).children("td:eq(2)").text();
            let cusEmail = $(this).children("td:eq(3)").text();
            let cusContact = $(this).children("td:eq(4)").text();

            $('#user_nic').val(cusNic);
            $('#user_name').val(cusName);
            $('#user_address').val(cusAddress);
            $('#user_contact').val(cusContact);
            $('#user_email').val(cusEmail);
            $.ajax({
                url: baseURL + "user?userEmail=" + cusEmail + "",
                dataType: 'json',
                success: function (res) {
                    for (let x of res.data) {
                        $('#userImg').empty();
                        document.getElementById("userImg").src = baseURL + x.imgUrl;
                    }

                },
                error: function (err) {
                    console.log("Can't Load Image : " + JSON.parse(err.responseText).message);
                }
            });
        });
    }

    $("#btnDeleteUser").click(function () {
        let email = $("#user_email").val();
        $.ajax({
            url: baseURL + "user?email=" + email + "",
            method: "delete",
            dataType: "json",
            success: function (resp) {
                alert(resp.message);
                loadAllCustomers();
            },
            error: function (error) {
                alert(JSON.parse(error.responseText).message);
            }
        });
    });


    // Car CRUD and Table Functions

    function loadAllCar() {
        $("#tblCar").empty();
        $.ajax({
            url: baseURL + "car",
            dataType: "json",
            success: function (resp) {
                for (let car of resp.data) {
                    var row = '<tr><th scope="row">' + car.registrationNo + '</th><td>' + car.carBrand + '</td><td>' + car.carType + '</td><td>' + car.numberOfPassengers + '</td><td>' + car.fuelType + '</td><td>' + car.transmissionType + '</td><td>' + car.color + '</td><td>' + car.dailyPrice + '</td><td>' + car.monthlyPrice + '</td><td>' + car.priceForExtraKM + '</td><td class="text-success">' + car.status + '</td><td class="text-success">' + car.available + '</td></tr>';
                    $("#tblCar").append(row);
                }
                bindRowClickEventsCar();
            }
        });
    }

    function bindRowClickEventsCar() {
        $("#tblCar>tr").click(function () {
            let carReg = $(this).find("th:eq(0)").text();
            let carBrand = $(this).find("td:eq(0)").text();
            let carType = $(this).find("td:eq(1)").text();
            let carPas = $(this).find("td:eq(2)").text();
            let carFuel = $(this).find("td:eq(3)").text();
            let carTransmission = $(this).find("td:eq(4)").text();
            let carColor = $(this).find("td:eq(5)").text();
            let carDay = $(this).find("td:eq(6)").text();
            let carMonth = $(this).find("td:eq(7)").text();
            let carKm = $(this).find("td:eq(8)").text();

            $('#registrationNo').val(carReg);
            $('#make').val(carBrand);
            $('#category').val(carType);
            $('#noOfPassengers').val(carPas);
            $('#fuel').val(carFuel);
            $('#transmission').val(carTransmission);
            $('#color').val(carColor);
            $('#priceDay').val(carDay);
            $('#priceMonth').val(carMonth);
            $('#priceKm').val(carKm);
        });
    }

    $("#btnSaveCar").click(function () {

        var formData = new FormData();
        let registrationNo = $("#registrationNo").val();
        let carBrand = $("#make").val();
        let carType = $("#category").val();
        let numberOfPassengers = $("#noOfPassengers").val();
        let transmissionType = $("#transmission").val();
        let fuelType = $("#fuel").val();
        let dailyPrice = $("#priceDay").val();
        let monthlyPrice = $("#priceMonth").val();
        let priceForExtraKM = $("#priceKm").val();
        let color = $("#color").val();
        let available = "Available";
        let status = "Good";

        formData.append("registrationNo", registrationNo);
        formData.append("carBrand", carBrand);
        formData.append("carType", carType);
        formData.append("numberOfPassengers", numberOfPassengers);
        formData.append("transmissionType", transmissionType);
        formData.append("fuelType", fuelType);
        formData.append("dailyPrice", dailyPrice);
        formData.append("monthlyPrice", monthlyPrice);
        formData.append("priceForExtraKM", priceForExtraKM);
        formData.append("color", color);
        formData.append("available", available);
        formData.append("status", status);

        let imgFront = $("#imgFront")[0].files[0];
        let imgFrontName = $("#imgFront")[0].files[0].name;
        formData.append("imgFrontFile", imgFront, imgFrontName);

        let imgBack = $("#imgBack")[0].files[0];
        let imgBackName = $("#imgBack")[0].files[0].name;
        formData.append("imgBackFile", imgBack, imgBackName);

        let imgSide = $("#imgSide")[0].files[0];
        let imgSideName = $("#imgSide")[0].files[0].name;
        formData.append("imgSideFile", imgSide, imgSideName);

        let imgInside = $("#imgInside")[0].files[0];
        let imgInsideName = $("#imgInside")[0].files[0].name;
        formData.append("imgInsideFile", imgInside, imgInsideName);

        $.ajax({
            url: baseURL + "car/saveImg",
            method: "post",
            data: formData,
            dataType: "json",
            async: true,
            contentType: false,
            processData: false,
            enctype: "multipart/form-data",
            success: function (resp) {
                loadAllCar();
                alert("Successfully Uploaded");
            },
            error: function (err) {
                console.log(err);
            }
        });
    });

    $("#btnUpdateCar").click(function () {
        let registrationNo = $("#registrationNo").val();
        let carBrand = $("#make").val();
        let carType = $("#category").val();
        let numberOfPassengers = $("#noOfPassengers").val();
        let transmissionType = $("#transmission").val();
        let fuelType = $("#fuel").val();
        let dailyPrice = $("#priceDay").val();
        let monthlyPrice = $("#priceMonth").val();
        let priceForExtraKM = $("#priceKm").val();
        let color = $("#color").val();
        let imgFront = $("#imgFront").val();
        let imgBack = $("#imgBack").val();
        let imgSide = $("#imgSide").val();
        let imgInside = $("#imgInside").val();

        var car = {
            registrationNo: registrationNo,
            carBrand: carBrand,
            carType: carType,
            numberOfPassengers: numberOfPassengers,
            transmissionType: transmissionType,
            fuelType: fuelType,
            dailyPrice: dailyPrice,
            monthlyPrice: monthlyPrice,
            priceForExtraKM: priceForExtraKM,
            color: color,
            imgFront: imgFront,
            imgBack: imgBack,
            imgSide: imgSide,
            imgInside: imgInside
        }

        $.ajax({
            url: baseURL + 'car',
            method: 'put',
            contentType: "application/json",
            data: JSON.stringify(car),
            dataType: "json",
            success: function (res) {
                alert(res.message);
                loadAllCar();
            },
            error: function (error) {
                let cause = JSON.parse(error.responseText).message;
                alert(cause);
            }

        });
    });

    $("#btnDeleteCar").click(function () {
        let registrationNo = $("#registrationNo").val();
        $.ajax({
            url: baseURL + "car?registrationNo=" + registrationNo + "",
            method: "delete",
            dataType: "json",
            success: function (resp) {
                alert(resp.message);
                loadAllCar();
            },
            error: function (error) {
                alert(JSON.parse(error.responseText).message);
            }
        });
    });


    // Driver CRUD and Table Functions

    function loadAllDriver() {
        $("#tblDriver").empty();
        $.ajax({
            url: baseURL + "driver",
            dataType: "json",
            success: function (resp) {
                for (let dri of resp.data) {
                    var row = '<tr><td>' + dri.driverNICorLicenceNo + '</td><td>' + dri.driverName + '</td><td>' + dri.driverContact + '</td><td>' + dri.driverEmail + '</td><td>' + dri.driverAddress + '</td><td>' + dri.available + '</td></tr>';
                    $("#tblDriver").append(row);
                }
                bindRowClickEventsDriver();
            }
        });
    }

    function bindRowClickEventsDriver() {
        $("#tblDriver>tr").click(function () {
            let drName = $(this).find("td:eq(1)").text();
            let drLic = $(this).find("td:eq(0)").text();
            let drContact = $(this).find("td:eq(2)").text();
            let drEmail = $(this).find("td:eq(3)").text();
            let drAddress = $(this).find("td:eq(4)").text();


            $('#dr_lic').val(drLic);
            $('#dr_name').val(drName);
            $('#dr_contact').val(drContact);
            $('#dr_email').val(drEmail);
            $('#dr_address').val(drAddress);

        });
    }

    $("#btnDeleteDriver").click(function () {
        let email = $("#dr_email").val();
        $.ajax({
            url: baseURL + "driver?email=" + email + "",
            method: "delete",
            dataType: "json",
            success: function (resp) {
                alert(resp.message);
                loadAllDriver();
            },
            error: function (error) {
                alert(JSON.parse(error.responseText).message);
            }
        });
    });

    $("#btnAddDriver").click(function () {
        var cusLogObj = {
            driverEmail: $("#dr_email").val(),
            driverName: $("#dr_name").val(),
            driverAddress: $("#dr_Address").val(),
            driverNICorLicenceNo: $("#dr_lic_").val(),
            driverContact: $("#dr_contact").val(),
            available: "Available"
        }

        $.ajax({
            url: baseURL + "driver/save",
            method: "post",
            data: JSON.stringify(cusLogObj),
            contentType: "application/json",
            dataType: "json",
            success: function (res) {
                alert(res.message);
            },
            error: function (err) {
                let message = JSON.parse(err.responseText).message;
                alert(message);
                console.log("Error : " + message)
            }
        });
        loadAllDriver();
    });


</script>
</body>
</html>